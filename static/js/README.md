# 仓库设计系统 - 模块化架构说明

## 项目结构

本仓库设计系统已从单文件架构重构为模块化架构，将原有的1066行`main.js`文件拆分为5个功能明确的模块文件，提高了代码的可维护性和可读性。

## 模块划分

### 1. 核心模块 (`core.js`)
- **功能**: Three.js场景初始化、渲染循环、窗口调整
- **主要职责**:
  - 场景、相机、渲染器初始化
  - 灯光、地面、坐标轴设置
  - 动画循环管理
  - 窗口大小调整处理
  - 提供核心Three.js对象的访问接口

### 2. 事件模块 (`events.js`)
- **功能**: 用户交互事件处理
- **主要职责**:
  - 鼠标点击事件处理
  - 鼠标移动悬停效果
  - 对象选择管理
  - 事件监听器初始化

### 3. 货架模块 (`shelf.js`)
- **功能**: 货架3D模型创建与管理
- **主要职责**:
  - 工业货架3D模型创建
  - 货物、格口生成
  - 安全标识系统
  - 四级标识系统（库区、货架、层、格口）
  - 货架外观更新
  - 货架数据管理

### 4. 信息模块 (`info.js`)
- **功能**: 信息显示与UI交互
- **主要职责**:
  - 货架详细信息展示
  - 货物信息展示
  - 格口信息展示
  - 状态提示（加载、错误、成功）
  - 统计信息更新

### 5. 控制模块 (`control.js`)
- **功能**: 业务逻辑控制与API交互
- **主要职责**:
  - 配置管理（加载、保存）
  - 货架操作（添加、删除、对齐等）
  - 视角控制
  - 导入导出功能
  - UI控制面板更新

## 新的主文件 (`main.js`)

新的`main.js`文件作为模块加载器，主要职责：
- 动态加载所有模块
- 初始化应用
- 设置定时任务
- 提供全局API接口
- 保持向后兼容性

## 使用方式

### 基本使用
```javascript
// 初始化应用
window.WarehouseAPI.initialize();

// 获取所有货架
const allShelves = window.WarehouseAPI.getShelves();

// 创建新货架
const newShelf = window.WarehouseAPI.createShelf(2, 3, 1, 0, 0);

// 设置视角
window.WarehouseAPI.setView('top');

// 导出配置
window.WarehouseAPI.exportConfig();
```

### 兼容旧接口
所有原有的全局函数仍然可用：
- `initializeShelves()`
- `addShelf()`
- `setView(viewType)`
- `zoomIn()`, `zoomOut()`
- `exportConfig()`, `importConfig()`
- 等等...

## 模块间通信

模块通过全局命名空间进行通信：
- `window.CoreModule`: 核心功能
- `window.EventsModule`: 事件处理
- `window.ShelfModule`: 货架管理
- `window.InfoModule`: 信息显示
- `window.ControlModule`: 控制功能

## 性能优化

1. **按需加载**: 模块可以按需动态加载
2. **缓存机制**: 频繁使用的数据会被缓存
3. **定时任务**: 自动保存和统计更新
4. **内存管理**: 更好的内存使用和垃圾回收

## 扩展性

新的架构使得添加新功能更加容易：
- 添加新模块不会影响现有功能
- 模块间低耦合，高内聚
- 清晰的接口定义
- 易于单元测试

## 文件统计

| 文件 | 行数 | 功能 |
|------|------|------|
| `main.js` | 134 | 模块加载器和API接口 |
| `core.js` | ~200 | Three.js核心功能 |
| `events.js` | ~150 | 事件处理 |
| `shelf.js` | ~400 | 货架创建和管理 |
| `info.js` | ~150 | 信息显示 |
| `control.js` | ~300 | 业务逻辑控制 |

**总计**: 从1066行单文件拆分为6个模块文件，每个文件平均200行左右，大大提高了代码的可维护性。